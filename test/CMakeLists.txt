file(GLOB TESTS "*_test.c")

foreach(TEST ${TESTS})
  string(REGEX REPLACE ".*/([^/]+).c" "\\1" NAME ${TEST})
  message("Adding test ${NAME}")
  add_executable(${NAME} "${NAME}.c" assertions.c stream_expectations.c)
  target_link_libraries(${NAME} cmocka)
  target_link_libraries(${NAME} cbor)
  add_test(${NAME} ${NAME})
  add_dependencies(coverage ${NAME})
endforeach(TEST)
